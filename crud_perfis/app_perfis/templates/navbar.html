<!-- navbar.html -->
<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #003366;">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Minha Aplicação</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <!-- Link para o perfil -->
                <li class="nav-item">
                    <a class="nav-link" href="/perfil/">Perfil</a>
                </li>
                <!-- Link para funcionários -->
                <li class="nav-item">
                    <a class="nav-link" href="/funcionarios/">Funcionários</a>
                </li>
                <!-- Link para departamento -->
                <li class="nav-item">
                    <a class="nav-link" href="/departamento/">departamento</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/criar_usuario/">Criar Usuário</a> <!-- Link para a página de criar usuário -->
                  </li>
                <!-- Exibir nome do usuário ou botão de logout -->
                <li class="nav-item">
                    <span id="userName" class="nav-link"></span>
                </li>
                <li class="nav-item">
                    <button id="logoutBtn" class="btn btn-danger">Sair</button>
                </li>
            </ul>
        </div>
    </div>
    
</nav>
<script>
    document.getElementById('logoutBtn').addEventListener('click', logout);

    function logout() {
        const refreshToken = localStorage.getItem('refresh_token');  // Recupera o refresh token do localStorage
        
        if (refreshToken) {
            // Enviar requisição POST para o backend para realizar o logout
            fetch('/api/logout/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`  // Envia o access token no cabeçalho
                },
                body: JSON.stringify({ refresh: refreshToken })  // Envia o refresh token no corpo da requisição
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Logout realizado com sucesso!') {
                    // Remover o token JWT e refresh token do localStorage
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token');
                    // Redirecionar para o login
                    window.location.href = "/login/";
                } else {
                    alert('Erro ao realizar logout: ' + data.detail);
                }
            })
            .catch(error => {
                console.error('Erro na requisição de logout:', error);
                alert('Erro ao tentar fazer logout. Tente novamente.');
            });
        } else {
            alert("Refresh token não encontrado.");
        }
    }
</script>
